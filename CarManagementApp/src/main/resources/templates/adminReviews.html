<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <title>Quản lý Đánh giá</title>
    <th:block th:replace="~{base :: styles}"></th:block>
</head>
<body>
<th:block th:replace="~{base :: header}"></th:block>

<div class="container mt-4">
    <h1 class="mb-4">Danh sách Tất cả Đánh giá</h1>

    <div class="card shadow-sm mb-4">
        <div class="card-header bg-light">
            <h5 class="card-title mb-0">Bộ lọc Đánh giá</h5>
        </div>
        <div class="card-body">
            <form th:action="@{/admin/reviews}" method="get">
                <div class="row g-3">
                    <div class="col-md-6 col-lg-3">
                        <label for="username" class="form-label">Tên người dùng</label>
                        <input type="text" id="username" name="username" class="form-control"
                               placeholder="Tìm theo username..."
                               th:value="${username}">
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <label for="rating" class="form-label">Xếp hạng</label>
                        <select id="rating" name="rating" class="form-select">
                            <option value="">-- Tất cả --</option>
                            <option value="1" th:selected="${rating != null and rating == 1}">1 sao</option>
                            <option value="2" th:selected="${rating != null and rating == 2}">2 sao</option>
                            <option value="3" th:selected="${rating != null and rating == 3}">3 sao</option>
                            <option value="4" th:selected="${rating != null and rating == 4}">4 sao</option>
                            <option value="5" th:selected="${rating != null and rating == 5}">5 sao</option>
                        </select>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <label for="startDate" class="form-label">Từ ngày & giờ</label>
                        <input type="datetime-local" id="startDate" name="startDate" class="form-control"
                               th:value="${startDate != null ? #temporals.format(startDate, 'yyyy-MM-dd''T''HH:mm') : ''}">
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <label for="endDate" class="form-label">Đến ngày & giờ</label>
                        <input type="datetime-local" id="endDate" name="endDate" class="form-control"
                               th:value="${endDate != null ? #temporals.format(endDate, 'yyyy-MM-dd''T''HH:mm') : ''}">
                    </div>
                    <div class="col-12 text-end mt-4">
                        <button type="submit" class="btn btn-primary me-2">
                            <i class="fas fa-search"></i> Tìm kiếm
                        </button>
                        <a th:href="@{/admin/reviews}" class="btn btn-secondary">
                            <i class="fas fa-undo"></i> Xóa bộ lọc
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div th:if="${infoMessage}" class="alert alert-info" role="alert">
        <p th:text="${infoMessage}"></p>
    </div>
    <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
        <p th:text="${errorMessage}"></p>
    </div>
    <div th:if="${successMessage}" class="alert alert-success" role="alert">
        <p th:text="${successMessage}"></p>
    </div>

    <div th:if="${reviews != null and not reviews.isEmpty()}">
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Mã ĐG</th>
                    <th>Người đánh giá</th>
                    <th>Chuyến đi</th>
                    <th>Xếp hạng</th>
                    <th>Nội dung</th>
                    <th>Ngày đánh giá</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="review : ${reviews}">
                    <td th:text="${review.id}"></td>
                    <td th:text="${review.userId != null ? review.userId.username : 'N/A'}"></td>
                    <td th:text="${review.tripId != null && review.tripId.routeId != null ?
                        review.tripId.routeId.origin + ' - ' + review.tripId.routeId.destination : 'N/A'}"></td>
                    <td>
                        <span th:each="i : ${#numbers.sequence(1, review.rating)}" class="text-warning">
                            <i class="fas fa-star"></i>
                        </span>
                    </td>
                    <td th:text="${review.comment}"></td>
                    <td th:text="${#temporals.format(review.createdAt, 'dd-MM-yyyy HH:mm:ss')}"></td>
                    <td>
                        <form th:action="@{'/admin/reviews/delete/' + ${review.id}}" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-danger btn-sm"
                                    onclick="return confirm('Bạn có chắc chắn muốn xóa đánh giá này không? Đây là hành động không thể hoàn tác.');">Xóa</button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div th:unless="${reviews != null and not reviews.isEmpty()}" class="alert alert-info text-center mt-3">
        Hiện chưa có đánh giá nào trong hệ thống.
    </div>
</div>

<th:block th:replace="~{base :: footer}"></th:block>
<div th:replace="base :: theme-scripts"></div>

</body>
</html>